import{_ as t,o as n,c as l,a2 as i,j as s,a as e}from"./chunks/framework.BI7Za5hW.js";const g=JSON.parse('{"title":"OpenTelemetry","description":"","frontmatter":{},"headers":[],"relativePath":"operator/telemetry.md","filePath":"operator/telemetry.md"}'),h={name:"operator/telemetry.md"};function p(r,a,o,k,d,c){return n(),l("div",null,[...a[0]||(a[0]=[i(`<h1 id="opentelemetry" tabindex="-1">OpenTelemetry <a class="header-anchor" href="#opentelemetry" aria-label="Permalink to &quot;OpenTelemetry&quot;">​</a></h1><p>KAOS supports OpenTelemetry for observability, including distributed tracing, metrics, and log correlation across all agent and MCP server operations.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>When enabled, OpenTelemetry instrumentation provides:</p><ul><li><strong>Tracing</strong>: Distributed traces across agent requests, model calls, tool executions, and delegations</li><li><strong>Metrics</strong>: Counters and histograms for requests, latency, and error rates</li><li><strong>Logs Export</strong>: Automatic export of Python logs via OTLP (in addition to trace_id/span_id correlation)</li></ul><h2 id="global-telemetry-configuration" tabindex="-1">Global Telemetry Configuration <a class="header-anchor" href="#global-telemetry-configuration" aria-label="Permalink to &quot;Global Telemetry Configuration&quot;">​</a></h2><p>You can enable telemetry globally for all components via Helm values:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># values.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">telemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://otel-collector.observability.svc.cluster.local:4317&quot;</span></span></code></pre></div><p>Install with global telemetry enabled:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> oci://ghcr.io/axsaucedo/kaos/chart</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> telemetry.enabled=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> telemetry.endpoint=&quot;http://otel-collector:4317&quot;</span></span></code></pre></div><p>All Agents and MCPServers will have telemetry enabled by default with this configuration.</p><h2 id="component-level-configuration" tabindex="-1">Component-Level Configuration <a class="header-anchor" href="#component-level-configuration" aria-label="Permalink to &quot;Component-Level Configuration&quot;">​</a></h2><p>Override global defaults or enable telemetry for specific components:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kaos.tools/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  modelAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-modelapi</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openai/gpt-4o&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Agent with OpenTelemetry enabled&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    telemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://otel-collector.monitoring.svc.cluster.local:4317&quot;</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kaos.tools/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MCPServer</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-tools</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">python-runtime</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    telemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://otel-collector.monitoring.svc.cluster.local:4317&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      fromString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        def echo(msg: str) -&gt; str:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            return msg</span></span></code></pre></div><h3 id="configuration-precedence" tabindex="-1">Configuration Precedence <a class="header-anchor" href="#configuration-precedence" aria-label="Permalink to &quot;Configuration Precedence&quot;">​</a></h3><p>Component-level configuration always overrides global defaults:</p><ol><li><strong>Component-level telemetry</strong> (highest priority): If <code>spec.config.telemetry</code> is set on the Agent or MCPServer, or <code>spec.telemetry</code> on ModelAPI, it is used</li><li><strong>Global Helm values</strong> (default): If component-level telemetry is not set, the global <code>telemetry.enabled</code> and <code>telemetry.endpoint</code> values are used</li></ol><h2 id="configuration-fields" tabindex="-1">Configuration Fields <a class="header-anchor" href="#configuration-fields" aria-label="Permalink to &quot;Configuration Fields&quot;">​</a></h2><p>The CRD configuration is intentionally minimal. For advanced settings, use standard <code>OTEL_*</code> environment variables via <code>spec.config.env</code>.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>enabled</code></td><td>bool</td><td><code>false</code></td><td>Enable OpenTelemetry instrumentation</td></tr><tr><td><code>endpoint</code></td><td>string</td><td>-</td><td>OTLP exporter endpoint (gRPC, required when enabled)</td></tr></tbody></table><h3 id="advanced-configuration-via-environment-variables" tabindex="-1">Advanced Configuration via Environment Variables <a class="header-anchor" href="#advanced-configuration-via-environment-variables" aria-label="Permalink to &quot;Advanced Configuration via Environment Variables&quot;">​</a></h3><p>For advanced configuration, use the standard <a href="https://opentelemetry-python.readthedocs.io/en/latest/sdk/environment_variables.html" target="_blank" rel="noreferrer">OpenTelemetry environment variables</a>:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    telemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://otel-collector:4317&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OTEL_EXPORTER_OTLP_INSECURE</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;false&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Use TLS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OTEL_EXPORTER_OTLP_HEADERS</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x-api-key=YOUR_KEY&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OTEL_TRACES_SAMPLER</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parentbased_traceidratio&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OTEL_TRACES_SAMPLER_ARG</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.1&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Sample 10% of traces</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OTEL_RESOURCE_ATTRIBUTES</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;deployment.environment=production&quot;</span></span></code></pre></div><p>The operator automatically sets:</p><ul><li><code>OTEL_SDK_DISABLED</code>: Set to &quot;false&quot; when telemetry is enabled (standard OTel env var)</li><li><code>OTEL_SERVICE_NAME</code>: Defaults to the CR name (e.g., agent name)</li><li><code>OTEL_EXPORTER_OTLP_ENDPOINT</code>: From <code>telemetry.endpoint</code></li><li><code>OTEL_RESOURCE_ATTRIBUTES</code>: Sets <code>service.namespace</code> and <code>kaos.resource.name</code></li></ul><h2 id="modelapi-telemetry" tabindex="-1">ModelAPI Telemetry <a class="header-anchor" href="#modelapi-telemetry" aria-label="Permalink to &quot;ModelAPI Telemetry&quot;">​</a></h2><p>ModelAPI supports telemetry for the LiteLLM Proxy mode. For Ollama Hosted mode, telemetry is not supported (Ollama has no native OTel support).</p><h3 id="litellm-proxy-mode" tabindex="-1">LiteLLM Proxy Mode <a class="header-anchor" href="#litellm-proxy-mode" aria-label="Permalink to &quot;LiteLLM Proxy Mode&quot;">​</a></h3><p>When <code>spec.telemetry.enabled: true</code> on a Proxy-mode ModelAPI:</p><ul><li>LiteLLM config is automatically updated with <code>success_callback: [&quot;otel&quot;]</code> and <code>failure_callback: [&quot;otel&quot;]</code></li><li>Environment variables <code>OTEL_EXPORTER</code>, <code>OTEL_EXPORTER_OTLP_ENDPOINT</code>, and <code>OTEL_SERVICE_NAME</code> are set</li><li>LiteLLM will send traces for each model call to the configured OTLP endpoint</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kaos.tools/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ModelAPI</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-modelapi</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Proxy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  telemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://otel-collector:4317&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  proxyConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    models</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openai&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    apiBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://api.openai.com/v1&quot;</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">Custom configYaml</p><p>If you provide a custom LiteLLM configuration via <code>proxyConfig.configYaml</code>, you must manually add the OTel callbacks:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">litellm_settings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  success_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;otel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  failure_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;otel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>The operator only auto-injects callbacks when using the default generated config.</p></div><h3 id="ollama-hosted-mode" tabindex="-1">Ollama Hosted Mode <a class="header-anchor" href="#ollama-hosted-mode" aria-label="Permalink to &quot;Ollama Hosted Mode&quot;">​</a></h3><p>If telemetry is enabled for a Hosted-mode ModelAPI, the operator emits a warning in the status message. Ollama does not have native OpenTelemetry support, so traces and metrics will not be collected from the model server itself.</p><h2 id="trace-spans" tabindex="-1">Trace Spans <a class="header-anchor" href="#trace-spans" aria-label="Permalink to &quot;Trace Spans&quot;">​</a></h2><p>The following spans are automatically created:</p><h3 id="http-request-auto-instrumented" tabindex="-1">HTTP Request (auto-instrumented) <a class="header-anchor" href="#http-request-auto-instrumented" aria-label="Permalink to &quot;HTTP Request (auto-instrumented)&quot;">​</a></h3><p>FastAPI/Starlette auto-instrumentation creates the root SERVER span for each HTTP request. This provides standard HTTP attributes like <code>http.method</code>, <code>http.url</code>, <code>http.status_code</code>.</p><h3 id="agent-agentic-loop" tabindex="-1">agent.agentic_loop <a class="header-anchor" href="#agent-agentic-loop" aria-label="Permalink to &quot;agent.agentic_loop&quot;">​</a></h3><p>Main processing span for agent reasoning. Attributes:</p><ul><li><code>agent.name</code>: Name of the agent</li><li><code>session.id</code>: Session identifier</li><li><code>agent.max_steps</code>: Maximum reasoning steps</li><li><code>stream</code>: Whether streaming is enabled</li></ul>`,42),s("h3",{n:"",id:"agent-step",tabindex:"-1"},[e("agent.step. "),s("a",{class:"header-anchor",href:"#agent-step","aria-label":'Permalink to "agent.step.{n}"'},"​")],-1),i('<p>Span for each iteration of the agentic reasoning loop. Attributes:</p><ul><li><code>step</code>: Step number (1-based)</li><li><code>max_steps</code>: Maximum allowed steps</li></ul><h3 id="model-inference" tabindex="-1">model.inference <a class="header-anchor" href="#model-inference" aria-label="Permalink to &quot;model.inference&quot;">​</a></h3><p>Span for LLM API calls. Attributes:</p><ul><li><code>gen_ai.request.model</code>: Model identifier</li></ul><h3 name="" id="tool" tabindex="-1">tool. <a class="header-anchor" href="#tool" aria-label="Permalink to &quot;tool.{name}&quot;">​</a></h3><p>Span for MCP tool executions. Attributes:</p><ul><li><code>tool.name</code>: Tool name</li></ul>',8),s("h3",{agent:"",id:"delegate",tabindex:"-1"},[e("delegate. "),s("a",{class:"header-anchor",href:"#delegate","aria-label":'Permalink to "delegate.{agent}"'},"​")],-1),i(`<p>Span for agent-to-agent delegations. Attributes:</p><ul><li><code>agent.delegation.target</code>: Target agent name</li></ul><h2 id="span-hierarchy-example" tabindex="-1">Span Hierarchy Example <a class="header-anchor" href="#span-hierarchy-example" aria-label="Permalink to &quot;Span Hierarchy Example&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HTTP POST /v1/chat/completions (SERVER, auto-instrumented)</span></span>
<span class="line"><span>└── agent.agentic_loop (INTERNAL)</span></span>
<span class="line"><span>    ├── agent.step.1 (INTERNAL)</span></span>
<span class="line"><span>    │   └── model.inference (CLIENT)</span></span>
<span class="line"><span>    ├── agent.step.2 (INTERNAL)</span></span>
<span class="line"><span>    │   ├── model.inference (CLIENT)</span></span>
<span class="line"><span>    │   └── tool.calculator (CLIENT)</span></span>
<span class="line"><span>    ├── agent.step.3 (INTERNAL)</span></span>
<span class="line"><span>    │   ├── model.inference (CLIENT)</span></span>
<span class="line"><span>    │   └── delegate.researcher (CLIENT)</span></span>
<span class="line"><span>    └── agent.step.4 (INTERNAL)</span></span>
<span class="line"><span>        └── model.inference (CLIENT)</span></span></code></pre></div><h2 id="metrics" tabindex="-1">Metrics <a class="header-anchor" href="#metrics" aria-label="Permalink to &quot;Metrics&quot;">​</a></h2><p>The following metrics are collected:</p><table tabindex="0"><thead><tr><th>Metric</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>kaos.requests</code></td><td>Counter</td><td>Total requests processed</td></tr><tr><td><code>kaos.request.duration</code></td><td>Histogram</td><td>Request duration in milliseconds</td></tr><tr><td><code>kaos.model.calls</code></td><td>Counter</td><td>Total model API calls</td></tr><tr><td><code>kaos.model.duration</code></td><td>Histogram</td><td>Model call duration in milliseconds</td></tr><tr><td><code>kaos.tool.calls</code></td><td>Counter</td><td>Total tool executions</td></tr><tr><td><code>kaos.tool.duration</code></td><td>Histogram</td><td>Tool execution duration in milliseconds</td></tr><tr><td><code>kaos.delegations</code></td><td>Counter</td><td>Total agent delegations</td></tr><tr><td><code>kaos.delegation.duration</code></td><td>Histogram</td><td>Delegation duration in milliseconds</td></tr></tbody></table><p>All metrics include labels:</p><ul><li><code>agent.name</code>: Name of the agent</li><li><code>success</code>: &quot;true&quot; or &quot;false&quot;</li></ul><p>Model metrics also include:</p><ul><li><code>model</code>: Model identifier</li></ul><p>Tool metrics also include:</p><ul><li><code>tool</code>: Name of the tool</li></ul><p>Delegation metrics also include:</p><ul><li><code>target</code>: Name of the target agent</li></ul><h2 id="log-correlation" tabindex="-1">Log Correlation <a class="header-anchor" href="#log-correlation" aria-label="Permalink to &quot;Log Correlation&quot;">​</a></h2><p>When OpenTelemetry is enabled, log entries automatically include trace context:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>2024-01-15 10:30:45 INFO [trace_id=abc123 span_id=def456] Processing message...</span></span></code></pre></div><p>This allows correlating logs with traces in your observability backend.</p><h2 id="example-agent-with-full-telemetry" tabindex="-1">Example: Agent with Full Telemetry <a class="header-anchor" href="#example-agent-with-full-telemetry" aria-label="Permalink to &quot;Example: Agent with Full Telemetry&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kaos.tools/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">traced-agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  modelAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-modelapi</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openai/gpt-4o&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  mcpServers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">calculator</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Agent with full OpenTelemetry observability&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    instructions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You are a helpful assistant with calculator access.&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    telemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://otel-collector.monitoring.svc.cluster.local:4317&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  agentNetwork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    access</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">researcher</span></span></code></pre></div><h2 id="setting-up-an-otel-collector" tabindex="-1">Setting Up an OTel Collector <a class="header-anchor" href="#setting-up-an-otel-collector" aria-label="Permalink to &quot;Setting Up an OTel Collector&quot;">​</a></h2><p>To collect telemetry, deploy an OpenTelemetry Collector in your cluster:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel-collector-config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">monitoring</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  config.yaml</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    receivers:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      otlp:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        protocols:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          grpc:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            endpoint: 0.0.0.0:4317</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          http:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            endpoint: 0.0.0.0:4318</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    processors:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      batch:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        timeout: 10s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    exporters:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      otlp:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        endpoint: &quot;your-backend:4317&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        tls:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          insecure: true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    service:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      pipelines:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        traces:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          receivers: [otlp]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          processors: [batch]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          exporters: [otlp]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        metrics:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          receivers: [otlp]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          processors: [batch]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          exporters: [otlp]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel-collector</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">monitoring</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel-collector</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel-collector</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">collector</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel/opentelemetry-collector:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--config=/etc/otel/config.yaml&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">containerPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4317</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otlp-grpc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">containerPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4318</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otlp-http</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        volumeMounts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          mountPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/otel</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        configMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel-collector-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel-collector</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">monitoring</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel-collector</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4317</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otlp-grpc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4318</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otlp-http</span></span></code></pre></div><h2 id="using-with-signoz" tabindex="-1">Using with SigNoz <a class="header-anchor" href="#using-with-signoz" aria-label="Permalink to &quot;Using with SigNoz&quot;">​</a></h2><p><a href="https://signoz.io/" target="_blank" rel="noreferrer">SigNoz</a> is an open-source APM that works well with KAOS:</p><ol><li>Deploy SigNoz in your cluster:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> signoz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://charts.signoz.io</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> signoz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> signoz/signoz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --create-namespace</span></span></code></pre></div><ol start="2"><li>Configure agents to send telemetry to SigNoz:</li></ol><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  telemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://signoz-otel-collector.monitoring.svc.cluster.local:4317&quot;</span></span></code></pre></div><ol start="3"><li>Access the SigNoz UI to view traces, metrics, and logs.</li></ol><h2 id="using-with-uptrace" tabindex="-1">Using with Uptrace <a class="header-anchor" href="#using-with-uptrace" aria-label="Permalink to &quot;Using with Uptrace&quot;">​</a></h2><p><a href="https://uptrace.dev/" target="_blank" rel="noreferrer">Uptrace</a> is another excellent option:</p><ol><li>Deploy Uptrace:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uptrace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://charts.uptrace.dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uptrace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uptrace/uptrace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --create-namespace</span></span></code></pre></div><ol start="2"><li>Configure agents:</li></ol><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  telemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://uptrace.monitoring.svc.cluster.local:14317&quot;</span></span></code></pre></div><h2 id="environment-variables" tabindex="-1">Environment Variables <a class="header-anchor" href="#environment-variables" aria-label="Permalink to &quot;Environment Variables&quot;">​</a></h2><p>The operator automatically sets these environment variables when telemetry is enabled:</p><p><strong>Agent and MCPServer:</strong></p><table tabindex="0"><thead><tr><th>Variable</th><th>Description</th></tr></thead><tbody><tr><td><code>OTEL_SDK_DISABLED</code></td><td>&quot;false&quot; when telemetry is enabled (standard OTel env var)</td></tr><tr><td><code>OTEL_EXPORTER_OTLP_ENDPOINT</code></td><td>OTLP endpoint URL from <code>telemetry.endpoint</code></td></tr><tr><td><code>OTEL_SERVICE_NAME</code></td><td>Defaults to CR name (agent or MCP server name)</td></tr><tr><td><code>OTEL_RESOURCE_ATTRIBUTES</code></td><td>Sets <code>service.namespace</code> and <code>kaos.resource.name</code>; if user sets same var in spec.config.env, their value takes precedence</td></tr><tr><td><code>OTEL_PYTHON_FASTAPI_EXCLUDED_URLS</code></td><td>Excludes <code>/health</code> and <code>/ready</code> endpoints from tracing (reduces noise from Kubernetes probes)</td></tr></tbody></table><p><strong>ModelAPI (LiteLLM):</strong></p><table tabindex="0"><thead><tr><th>Variable</th><th>Description</th></tr></thead><tbody><tr><td><code>OTEL_EXPORTER</code></td><td>&quot;otlp_grpc&quot; for gRPC OTLP exporter (port 4317); use &quot;otlp_http&quot; for HTTP (port 4318)</td></tr><tr><td><code>OTEL_EXPORTER_OTLP_ENDPOINT</code></td><td>OTLP endpoint URL from <code>telemetry.endpoint</code></td></tr><tr><td><code>OTEL_SERVICE_NAME</code></td><td>Defaults to ModelAPI CR name</td></tr><tr><td><code>OTEL_PYTHON_EXCLUDED_URLS</code></td><td>Excludes <code>/health</code> endpoints from tracing (generic exclusion for all instrumentations)</td></tr></tbody></table><p>For additional configuration, use standard <a href="https://opentelemetry-python.readthedocs.io/en/latest/sdk/environment_variables.html" target="_blank" rel="noreferrer">OpenTelemetry environment variables</a> via <code>spec.config.env</code>.</p><h2 id="logging-configuration" tabindex="-1">Logging Configuration <a class="header-anchor" href="#logging-configuration" aria-label="Permalink to &quot;Logging Configuration&quot;">​</a></h2><h3 id="log-level" tabindex="-1">Log Level <a class="header-anchor" href="#log-level" aria-label="Permalink to &quot;Log Level&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>LOG_LEVEL</code></td><td><code>INFO</code></td><td>Log level for all components (TRACE, DEBUG, INFO, WARNING, ERROR)</td></tr><tr><td><code>AGENT_LOG_LEVEL</code></td><td>-</td><td>Fallback for LOG_LEVEL (backwards compatibility)</td></tr></tbody></table><p>The log level controls:</p><ul><li>Python logging output to stdout</li><li>OTEL log export level (DEBUG logs only exported when LOG_LEVEL=DEBUG)</li></ul><h3 id="http-tracing-options" tabindex="-1">HTTP Tracing Options <a class="header-anchor" href="#http-tracing-options" aria-label="Permalink to &quot;HTTP Tracing Options&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>OTEL_INCLUDE_HTTP_CLIENT</code></td><td><code>false</code></td><td>Enable HTTPX client span tracing and logging</td></tr><tr><td><code>OTEL_INCLUDE_HTTP_SERVER</code></td><td><code>false</code></td><td>Enable FastAPI span tracing and uvicorn access logs</td></tr></tbody></table><p><strong>OTEL_INCLUDE_HTTP_CLIENT:</strong></p><p>When <strong>disabled</strong> (default):</p><ul><li>HTTPX client calls do NOT create trace spans</li><li>Trace context is still propagated via headers (manual injection)</li><li><code>httpx</code>, <code>httpcore</code>, <code>mcp.client.streamable_http</code> loggers set to WARNING</li><li>Reduces noise from MCP SSE connections which create many HTTP calls</li></ul><p>When <strong>enabled</strong> (<code>true</code>):</p><ul><li>All HTTPX client calls create trace spans (noisy)</li><li>HTTP client loggers use configured LOG_LEVEL</li><li>Useful for debugging network issues</li></ul><p><strong>OTEL_INCLUDE_HTTP_SERVER:</strong></p><p>When <strong>disabled</strong> (default):</p><ul><li>FastAPI incoming requests do NOT create HTTP spans</li><li>Trace context is still extracted from headers (manual extraction)</li><li>Uvicorn access logs are suppressed (no &quot;GET /health 200&quot; messages)</li><li>Reduces noise from Kubernetes health/readiness probes</li></ul><p>When <strong>enabled</strong> (<code>true</code>):</p><ul><li>FastAPI incoming requests create trace spans (noisy)</li><li>Uvicorn access logs are emitted at configured LOG_LEVEL</li><li>Useful for debugging incoming request issues</li></ul><h3 id="log-record-attributes" tabindex="-1">Log Record Attributes <a class="header-anchor" href="#log-record-attributes" aria-label="Permalink to &quot;Log Record Attributes&quot;">​</a></h3><p>OTEL log exports include these attributes:</p><table tabindex="0"><thead><tr><th>Attribute</th><th>Description</th></tr></thead><tbody><tr><td><code>logger_name</code></td><td>Python logger name (e.g., <code>agent.client</code>, <code>mcptools.server</code>)</td></tr><tr><td><code>code.filepath</code></td><td>Source file path</td></tr><tr><td><code>code.function</code></td><td>Function name</td></tr><tr><td><code>code.lineno</code></td><td>Line number</td></tr></tbody></table><h3 id="log-span-correlation" tabindex="-1">Log/Span Correlation <a class="header-anchor" href="#log-span-correlation" aria-label="Permalink to &quot;Log/Span Correlation&quot;">​</a></h3><p>When OTEL is enabled, all log entries within a traced request include:</p><ul><li><code>trace_id</code> - correlates with the request trace</li><li><code>span_id</code> - correlates with the active span</li></ul><p><strong>Important:</strong> Logs must be emitted BEFORE <code>span_failure()</code> or AFTER <code>span_begin()</code> to include trace correlation.</p><h2 id="distributed-tracing" tabindex="-1">Distributed Tracing <a class="header-anchor" href="#distributed-tracing" aria-label="Permalink to &quot;Distributed Tracing&quot;">​</a></h2><p>KAOS implements <strong>manual trace context propagation</strong> across agent delegations:</p><ul><li><strong>Outgoing requests</strong> (RemoteAgent): Automatically injects <code>traceparent</code>/<code>tracestate</code> headers</li><li><strong>Incoming requests</strong> (AgentServer): Automatically extracts trace context from headers</li></ul><p>This ensures traces are connected across agent-to-agent delegations <strong>without</strong> requiring HTTPX/FastAPI auto-instrumentation, avoiding noisy HTTP spans.</p><h2 id="health-check-exclusions" tabindex="-1">Health Check Exclusions <a class="header-anchor" href="#health-check-exclusions" aria-label="Permalink to &quot;Health Check Exclusions&quot;">​</a></h2><p>By default, Kubernetes liveness and readiness probe endpoints are excluded from telemetry traces. This prevents excessive trace data from health checks that typically run every 10-30 seconds.</p><h3 id="excluded-endpoints" tabindex="-1">Excluded Endpoints <a class="header-anchor" href="#excluded-endpoints" aria-label="Permalink to &quot;Excluded Endpoints&quot;">​</a></h3><p><strong>Agent and MCPServer (Python):</strong></p><ul><li><code>/health</code> - Kubernetes liveness probe</li><li><code>/ready</code> - Kubernetes readiness probe</li></ul><p>These are excluded via the <code>OTEL_PYTHON_FASTAPI_EXCLUDED_URLS</code> environment variable set to <code>/health,/ready</code>. The patterns use regex <code>search()</code> (not <code>match()</code>), so they match anywhere in the URL path.</p><p><strong>ModelAPI (LiteLLM):</strong></p><ul><li><code>/health/liveliness</code>, <code>/health/liveness</code>, <code>/health/readiness</code></li></ul><p>These endpoints are excluded via the <code>OTEL_PYTHON_EXCLUDED_URLS</code> environment variable set to <code>/health</code>. This matches all health-related endpoints.</p><h3 id="customizing-exclusions" tabindex="-1">Customizing Exclusions <a class="header-anchor" href="#customizing-exclusions" aria-label="Permalink to &quot;Customizing Exclusions&quot;">​</a></h3><p>To exclude additional URLs from tracing, override the <code>OTEL_PYTHON_FASTAPI_EXCLUDED_URLS</code> environment variable:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    telemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://otel-collector:4317&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OTEL_PYTHON_FASTAPI_EXCLUDED_URLS</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/health,/ready,/metrics,/internal&quot;</span></span></code></pre></div><p>The value is a comma-separated list of patterns. Patterns are matched using regex <code>search()</code>, so <code>/health</code> will match any URL containing <code>/health</code>. Note that when you override this variable, you must include the default patterns (<code>/health,/ready</code>) if you still want to exclude health checks.</p><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="no-traces-appearing" tabindex="-1">No traces appearing <a class="header-anchor" href="#no-traces-appearing" aria-label="Permalink to &quot;No traces appearing&quot;">​</a></h3><ol><li>Verify telemetry is enabled:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-agent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jsonpath=&#39;{.spec.config.telemetry}&#39;</span></span></code></pre></div><ol start="2"><li>Check agent logs for OTel initialization:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agent=my-agent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> otel</span></span></code></pre></div><ol start="3"><li>Verify collector is reachable:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy/agent-my-agent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://otel-collector.monitoring:4317</span></span></code></pre></div><h3 id="high-latency" tabindex="-1">High latency <a class="header-anchor" href="#high-latency" aria-label="Permalink to &quot;High latency&quot;">​</a></h3><p>If telemetry adds noticeable latency:</p><ul><li>Use batching in the OTel collector</li><li>Configure sampling via <code>OTEL_TRACES_SAMPLER</code> and <code>OTEL_TRACES_SAMPLER_ARG</code> env vars</li></ul><h3 id="missing-spans" tabindex="-1">Missing spans <a class="header-anchor" href="#missing-spans" aria-label="Permalink to &quot;Missing spans&quot;">​</a></h3><p>Ensure all sub-agents and MCP servers are instrumented:</p><ul><li>Each agent should have its own telemetry config</li><li>MCP servers should also have telemetry enabled</li><li>Trace context propagates automatically via W3C Trace Context headers</li></ul>`,99)])])}const y=t(h,[["render",p]]);export{g as __pageData,y as default};

import{_ as n,C as l,o as a,c as h,a2 as i,b as p,w as e,a as k,E as r,a3 as d}from"./chunks/framework.x4NSJ8gp.js";const b=JSON.parse('{"title":"Gateway API Integration","description":"","frontmatter":{},"headers":[],"relativePath":"operator/gateway-api.md","filePath":"operator/gateway-api.md"}'),o={name:"operator/gateway-api.md"};function g(c,s,F,y,u,C){const t=l("Mermaid");return a(),h("div",null,[s[1]||(s[1]=i('<h1 id="gateway-api-integration" tabindex="-1">Gateway API Integration <a class="header-anchor" href="#gateway-api-integration" aria-label="Permalink to &quot;Gateway API Integration&quot;">​</a></h1><p>KAOS supports the <a href="https://gateway-api.sigs.k8s.io/" target="_blank" rel="noreferrer">Kubernetes Gateway API</a> for exposing Agent, ModelAPI, and MCPServer resources via a unified ingress point.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>When Gateway API is enabled, the operator automatically creates HTTPRoute resources for each managed resource, allowing external access through a central Gateway.</p>',4)),(a(),p(d,null,{default:e(()=>[r(t,{id:"mermaid-12",class:"mermaid",graph:"flowchart%20TB%0A%20%20%20%20client%5B%22External%20Client%3Cbr%2F%3Ehttp%3A%2F%2Fgateway-host%2F%7Bnamespace%7D%2F%7Btype%7D%2F%7Bname%7D%2F...%22%5D%0A%20%20%20%20%0A%20%20%20%20subgraph%20gateway%5B%22Gateway%20(envoy%2C%20nginx%2C%20etc.)%22%5D%0A%20%20%20%20%20%20%20%20route1%5B%22HTTPRoute%3Cbr%2F%3E%2Fns%2Fagent%2Fa%22%5D%0A%20%20%20%20%20%20%20%20route2%5B%22HTTPRoute%3Cbr%2F%3E%2Fns%2Fmodelapi%2Fm%22%5D%0A%20%20%20%20%20%20%20%20route3%5B%22HTTPRoute%3Cbr%2F%3E%2Fns%2Fmcp%2Fm%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20user%5B%22User%20Namespace%22%5D%0A%20%20%20%20%20%20%20%20svc1%5B%22Agent%20Service%22%5D%0A%20%20%20%20%20%20%20%20svc2%5B%22ModelAPI%20Service%22%5D%0A%20%20%20%20%20%20%20%20svc3%5B%22MCPServer%20Service%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20client%20--%3E%20gateway%0A%20%20%20%20route1%20--%3E%20svc1%0A%20%20%20%20route2%20--%3E%20svc2%0A%20%20%20%20route3%20--%3E%20svc3%0A"})]),fallback:e(()=>[...s[0]||(s[0]=[k(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=i(`<h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><ol><li><p><strong>Gateway API CRDs</strong> - Install the Gateway API CRDs:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.4.1/standard-install.yaml</span></span></code></pre></div></li><li><p><strong>Gateway Controller</strong> - Install a Gateway controller (e.g., Envoy Gateway, Kong, Nginx):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Example: Envoy Gateway</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> envoy-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> oci://docker.io/envoyproxy/gateway-helm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.4.6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> envoy-gateway-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --create-namespace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --skip-crds</span></span></code></pre></div></li><li><p><strong>GatewayClass</strong> - Create a GatewayClass:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: gateway.networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: GatewayClass</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: envoy-gateway</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  controllerName: gateway.envoyproxy.io/gatewayclass-controller</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div></li></ol><h2 id="installation-with-gateway-api" tabindex="-1">Installation with Gateway API <a class="header-anchor" href="#installation-with-gateway-api" aria-label="Permalink to &quot;Installation with Gateway API&quot;">​</a></h2><h3 id="using-helm" tabindex="-1">Using Helm <a class="header-anchor" href="#using-helm" aria-label="Permalink to &quot;Using Helm&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./operator/chart</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --create-namespace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gatewayAPI.enabled=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gatewayAPI.createGateway=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gatewayAPI.gatewayClassName=envoy-gateway</span></span></code></pre></div><h3 id="helm-values" tabindex="-1">Helm Values <a class="header-anchor" href="#helm-values" aria-label="Permalink to &quot;Helm Values&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Value</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>gatewayAPI.enabled</code></td><td><code>false</code></td><td>Enable Gateway API integration</td></tr><tr><td><code>gatewayAPI.gatewayName</code></td><td><code>kaos-gateway</code></td><td>Name of the Gateway resource</td></tr><tr><td><code>gatewayAPI.gatewayNamespace</code></td><td>Release namespace</td><td>Namespace of the Gateway</td></tr><tr><td><code>gatewayAPI.createGateway</code></td><td><code>false</code></td><td>Create a Gateway resource</td></tr><tr><td><code>gatewayAPI.gatewayClassName</code></td><td>Required if createGateway</td><td>GatewayClass to use</td></tr><tr><td><code>gatewayAPI.listenerPort</code></td><td><code>80</code></td><td>Port for HTTP listener</td></tr><tr><td><code>gateway.defaultTimeouts.agent</code></td><td><code>120s</code></td><td>Default timeout for Agent HTTPRoutes</td></tr><tr><td><code>gateway.defaultTimeouts.modelAPI</code></td><td><code>120s</code></td><td>Default timeout for ModelAPI HTTPRoutes</td></tr><tr><td><code>gateway.defaultTimeouts.mcp</code></td><td><code>30s</code></td><td>Default timeout for MCPServer HTTPRoutes</td></tr></tbody></table><h2 id="request-timeouts" tabindex="-1">Request Timeouts <a class="header-anchor" href="#request-timeouts" aria-label="Permalink to &quot;Request Timeouts&quot;">​</a></h2><p>The operator configures request timeouts on HTTPRoutes to prevent long-running requests from timing out prematurely. Timeouts can be configured at two levels:</p><h3 id="global-defaults-helm-values" tabindex="-1">Global Defaults (Helm Values) <a class="header-anchor" href="#global-defaults-helm-values" aria-label="Permalink to &quot;Global Defaults (Helm Values)&quot;">​</a></h3><p>Set default timeouts for all resources of each type:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">gateway</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  defaultTimeouts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;120s&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # Agents may do multi-step reasoning</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    modelAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;120s&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # LLM inference can take time</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    mcp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;30s&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # Tool calls are typically fast</span></span></code></pre></div><p>These values are passed to the operator via environment variables:</p><ul><li><code>GATEWAY_DEFAULT_AGENT_TIMEOUT</code></li><li><code>GATEWAY_DEFAULT_MODELAPI_TIMEOUT</code></li><li><code>GATEWAY_DEFAULT_MCP_TIMEOUT</code></li></ul><h3 id="per-resource-override" tabindex="-1">Per-Resource Override <a class="header-anchor" href="#per-resource-override" aria-label="Permalink to &quot;Per-Resource Override&quot;">​</a></h3><p>Override the timeout for a specific resource using <code>spec.gatewayRoute.timeout</code>:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kaos.tools/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">long-running-agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  modelAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-model</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  gatewayRoute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;300s&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 5 minutes for this specific agent</span></span></code></pre></div><p>This works for all CRD types (Agent, ModelAPI, MCPServer).</p><h3 id="using-existing-gateway" tabindex="-1">Using Existing Gateway <a class="header-anchor" href="#using-existing-gateway" aria-label="Permalink to &quot;Using Existing Gateway&quot;">​</a></h3><p>To use an existing Gateway instead of creating one:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./operator/chart</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --create-namespace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gatewayAPI.enabled=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gatewayAPI.gatewayName=my-gateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gatewayAPI.gatewayNamespace=gateway-ns</span></span></code></pre></div><h2 id="url-structure" tabindex="-1">URL Structure <a class="header-anchor" href="#url-structure" aria-label="Permalink to &quot;URL Structure&quot;">​</a></h2><p>HTTPRoutes use a consistent path structure:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/{namespace}/{resource-type}/{resource-name}/...</span></span></code></pre></div><table tabindex="0"><thead><tr><th>Resource Type</th><th>Path Pattern</th><th>Example</th></tr></thead><tbody><tr><td>Agent</td><td><code>/{ns}/agent/{name}</code></td><td><code>/prod/agent/coordinator/health</code></td></tr><tr><td>ModelAPI</td><td><code>/{ns}/modelapi/{name}</code></td><td><code>/prod/modelapi/ollama-proxy/v1/chat/completions</code></td></tr><tr><td>MCPServer</td><td><code>/{ns}/mcp/{name}</code></td><td><code>/dev/mcp/echo-server/health</code></td></tr></tbody></table><h3 id="path-rewriting" tabindex="-1">Path Rewriting <a class="header-anchor" href="#path-rewriting" aria-label="Permalink to &quot;Path Rewriting&quot;">​</a></h3><p>The operator configures HTTPRoutes with URL rewriting to strip the path prefix. When you call:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>http://gateway/my-namespace/agent/my-agent/health</span></span></code></pre></div><p>The backend service receives:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/health</span></span></code></pre></div><h2 id="example-accessing-an-agent-via-gateway" tabindex="-1">Example: Accessing an Agent via Gateway <a class="header-anchor" href="#example-accessing-an-agent-via-gateway" aria-label="Permalink to &quot;Example: Accessing an Agent via Gateway&quot;">​</a></h2><ol><li><p>Deploy an agent:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kaos.tools/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-namespace</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  modelAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-model</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Example agent&quot;</span></span></code></pre></div></li><li><p>Access via Gateway:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Health check</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost/my-namespace/agent/my-agent/health</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Agent card</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost/my-namespace/agent/my-agent/.well-known/agent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Chat completions</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost/my-namespace/agent/my-agent/v1/chat/completions</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;model&quot;:&quot;my-agent&quot;,&quot;messages&quot;:[{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;Hello&quot;}]}&#39;</span></span></code></pre></div></li></ol><h2 id="verifying-httproutes" tabindex="-1">Verifying HTTPRoutes <a class="header-anchor" href="#verifying-httproutes" aria-label="Permalink to &quot;Verifying HTTPRoutes&quot;">​</a></h2><p>Check created HTTPRoutes:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> httproutes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span></span></code></pre></div><p>Example output:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>NAMESPACE      NAME                     HOSTNAMES   AGE</span></span>
<span class="line"><span>my-namespace   agent-my-agent                       5m</span></span>
<span class="line"><span>my-namespace   modelapi-my-model                    5m</span></span></code></pre></div><p>View HTTPRoute details:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> httproute</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agent-my-agent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-namespace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yaml</span></span></code></pre></div><h2 id="disabling-gateway-api" tabindex="-1">Disabling Gateway API <a class="header-anchor" href="#disabling-gateway-api" aria-label="Permalink to &quot;Disabling Gateway API&quot;">​</a></h2><p>To run without Gateway API (using direct service access):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./operator/chart</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --create-namespace</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # gatewayAPI.enabled defaults to false</span></span></code></pre></div><p>Without Gateway API, access services via port-forward:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> svc/agent-my-agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8080:8000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-namespace</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/health</span></span></code></pre></div><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="httproute-not-created" tabindex="-1">HTTPRoute Not Created <a class="header-anchor" href="#httproute-not-created" aria-label="Permalink to &quot;HTTPRoute Not Created&quot;">​</a></h3><p>Check operator logs:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-system</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment/kaos-operator-controller-manager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HTTPRoute</span></span></code></pre></div><p>Verify Gateway API is enabled:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmap</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-system</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-operator-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yaml</span></span></code></pre></div><h3 id="_404-errors" tabindex="-1">404 Errors <a class="header-anchor" href="#_404-errors" aria-label="Permalink to &quot;404 Errors&quot;">​</a></h3><ol><li><p>Verify the HTTPRoute exists and is accepted:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> httproute</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your-namespace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wide</span></span></code></pre></div></li><li><p>Check HTTPRoute status:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> httproute</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agent-your-agent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your-namespace</span></span></code></pre></div></li><li><p>Verify the Gateway is programmed:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-system</span></span></code></pre></div></li></ol><h3 id="rbac-errors" tabindex="-1">RBAC Errors <a class="header-anchor" href="#rbac-errors" aria-label="Permalink to &quot;RBAC Errors&quot;">​</a></h3><p>If you see &quot;forbidden&quot; errors for httproutes, ensure the operator has proper RBAC:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clusterrole</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-operator-kaos-operator</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yaml</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gateway</span></span></code></pre></div><h2 id="internal-routing-future" tabindex="-1">Internal Routing (Future) <a class="header-anchor" href="#internal-routing-future" aria-label="Permalink to &quot;Internal Routing (Future)&quot;">​</a></h2><p>When Gateway API is enabled, agents can optionally use Gateway URLs for inter-agent communication instead of direct service DNS. This feature is planned for future releases.</p>`,57))])}const E=n(o,[["render",g]]);export{b as __pageData,E as default};

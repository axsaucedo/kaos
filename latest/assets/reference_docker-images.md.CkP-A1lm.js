import{_ as a,o as i,c as e,ag as t}from"./chunks/framework.BypL_Yd_.js";const c=JSON.parse('{"title":"Docker Images","description":"","frontmatter":{},"headers":[],"relativePath":"reference/docker-images.md","filePath":"reference/docker-images.md"}'),n={name:"reference/docker-images.md"};function l(h,s,p,r,k,d){return i(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="docker-images" tabindex="-1">Docker Images <a class="header-anchor" href="#docker-images" aria-label="Permalink to &quot;Docker Images&quot;">​</a></h1><p>Official Docker images for KAOS are published to Docker Hub.</p><h2 id="available-images" tabindex="-1">Available Images <a class="header-anchor" href="#available-images" aria-label="Permalink to &quot;Available Images&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Image</th><th>Description</th><th>Source</th></tr></thead><tbody><tr><td><code>axsauze/kaos-operator:latest</code></td><td>Kubernetes operator controller</td><td><code>operator/Dockerfile</code></td></tr><tr><td><code>axsauze/kaos-agent:latest</code></td><td>Agent runtime and MCP server</td><td><code>python/Dockerfile</code></td></tr></tbody></table><h2 id="pulling-images" tabindex="-1">Pulling Images <a class="header-anchor" href="#pulling-images" aria-label="Permalink to &quot;Pulling Images&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> axsauze/kaos-operator:latest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> axsauze/kaos-agent:latest</span></span></code></pre></div><h2 id="image-tags" tabindex="-1">Image Tags <a class="header-anchor" href="#image-tags" aria-label="Permalink to &quot;Image Tags&quot;">​</a></h2><ul><li><code>latest</code> - Built from main branch on each merge</li><li><code>&lt;sha&gt;</code> - Git commit SHA for specific versions</li></ul><h2 id="helm-chart-defaults" tabindex="-1">Helm Chart Defaults <a class="header-anchor" href="#helm-chart-defaults" aria-label="Permalink to &quot;Helm Chart Defaults&quot;">​</a></h2><p>The Helm chart uses these default images:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># operator/chart/values.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">controllerManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  manager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      repository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">axsauze/kaos-operator</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">latest</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">defaultImages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  agentRuntime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;axsauze/kaos-agent:latest&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  mcpServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;axsauze/kaos-agent:latest&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  litellm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ghcr.io/berriai/litellm:main-latest&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ollama</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;alpine/ollama:latest&quot;</span></span></code></pre></div><h2 id="overriding-images" tabindex="-1">Overriding Images <a class="header-anchor" href="#overriding-images" aria-label="Permalink to &quot;Overriding Images&quot;">​</a></h2><h3 id="at-install-time" tabindex="-1">At Install Time <a class="header-anchor" href="#at-install-time" aria-label="Permalink to &quot;At Install Time&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./operator/chart</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --create-namespace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> controllerManager.manager.image.tag=v1.0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> defaultImages.agentRuntime=myregistry/kaos-agent:v1.0.0</span></span></code></pre></div><h3 id="in-crd-agent" tabindex="-1">In CRD (Agent) <a class="header-anchor" href="#in-crd-agent" aria-label="Permalink to &quot;In CRD (Agent)&quot;">​</a></h3><p>Agent images can be customized via podSpec:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kaos.tools/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  modelAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ollama</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  podSpec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">myregistry/custom-agent:v1.0.0</span></span></code></pre></div><h2 id="building-images-locally" tabindex="-1">Building Images Locally <a class="header-anchor" href="#building-images-locally" aria-label="Permalink to &quot;Building Images Locally&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build operator</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> operator</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-operator:dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build agent</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kaos-agent:dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre></div><h2 id="ci-cd-pipeline" tabindex="-1">CI/CD Pipeline <a class="header-anchor" href="#ci-cd-pipeline" aria-label="Permalink to &quot;CI/CD Pipeline&quot;">​</a></h2><p>Images are automatically built and pushed via GitHub Actions:</p><ul><li><strong>Trigger</strong>: Push to <code>main</code> branch</li><li><strong>Workflow</strong>: <code>.github/workflows/docker-push.yaml</code></li><li><strong>Tags</strong>: <code>latest</code> and git commit SHA</li></ul><h3 id="build-optimization" tabindex="-1">Build Optimization <a class="header-anchor" href="#build-optimization" aria-label="Permalink to &quot;Build Optimization&quot;">​</a></h3><p>Docker builds use several optimization techniques:</p><ol><li><strong>GitHub Actions Cache (GHA)</strong> - BuildKit layers are cached in GitHub&#39;s cache storage</li><li><strong>Scoped Caches</strong> - Each image has its own cache scope to avoid conflicts</li><li><strong>Cache Mounts</strong> - Go modules and pip packages are cached during builds</li><li><strong>Layer Ordering</strong> - Dependencies are copied before source code for better cache hits</li></ol><p>The Dockerfiles use BuildKit cache mounts:</p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Go - cache modules and build cache</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --mount=type=cache,target=/go/pkg/mod \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    --mount=type=cache,target=/root/.cache/go-build \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    go build -o manager main.go</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Python - cache pip/uv packages</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --mount=type=cache,target=/root/.cache/uv \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uv pip install -r requirements.txt</span></span></code></pre></div><h3 id="cache-cleanup" tabindex="-1">Cache Cleanup <a class="header-anchor" href="#cache-cleanup" aria-label="Permalink to &quot;Cache Cleanup&quot;">​</a></h3><p>When a PR is closed or merged, caches for that PR branch are automatically cleaned up via <code>.github/workflows/cache-cleanup.yaml</code>. This prevents cache storage from filling up with stale PR caches.</p><h3 id="required-secrets" tabindex="-1">Required Secrets <a class="header-anchor" href="#required-secrets" aria-label="Permalink to &quot;Required Secrets&quot;">​</a></h3><p>For the GitHub Action to push images:</p><ul><li><code>DOCKERHUB_USERNAME</code> - Docker Hub username</li><li><code>DOCKERHUB_TOKEN</code> - Docker Hub access token</li></ul><h2 id="third-party-images" tabindex="-1">Third-Party Images <a class="header-anchor" href="#third-party-images" aria-label="Permalink to &quot;Third-Party Images&quot;">​</a></h2><p>KAOS uses these third-party images:</p><table tabindex="0"><thead><tr><th>Image</th><th>Used By</th><th>Purpose</th></tr></thead><tbody><tr><td><code>ghcr.io/berriai/litellm:main-latest</code></td><td>ModelAPI (Proxy mode)</td><td>LLM API proxy</td></tr><tr><td><code>alpine/ollama:latest</code></td><td>ModelAPI (Hosted mode)</td><td>In-cluster Ollama</td></tr></tbody></table><p>These can be overridden in the Helm chart values.</p>`,36)])])}const g=a(n,[["render",l]]);export{c as __pageData,g as default};
